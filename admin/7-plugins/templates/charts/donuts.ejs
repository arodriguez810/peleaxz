<%
var name = name || "";
var options = {
    title: params.capitalize(name),
    type: "text",
    icon: {
        class: "none",
        position: "left",
        color: TAG.table + "-800"
    },
    items: ['n/a']
};

options = OBJECT.merge(options, opts); var nameclean = name.replace(/\./g, '_');
options.model = options.model ? options.model : false;
var toclient = JSON.stringify(options);
%>
<script>
    <%= model %>.triggers.table.before.control("<%= name %>");
    if (!<%= model %>.
    charts
    )<%= model %>.charts = {};
    eval(`<%= model %>.charts.<%= name %> = ${"<%= toclient %>".replaceAll("&#34;", '"').replaceAll("&#39", "'")}`);
</script>

<script>

    $(function () {

        // Set paths
        // ------------------------------
        if(<%= model %>.charts.<%= name %>.onLoad===undefined)
        <%= model %>.charts.<%= name %>.onLoad = function(){

        }

        require.config({
            paths: {
                echarts: 'assets/js/plugins/visualization/echarts'
            }
        });
        require(
            [
                'echarts',
                'echarts/theme/limitless',
                'echarts/chart/pie',
                'echarts/chart/funnel'
            ],
            function (ec, limitless) {
                <%= model %>.
                charts.<%= name %>_chart = ec.init(document.getElementById('<%= name %>'), limitless);
                <%= model %>.charts.<%= name %>.refresh  = function () {
                <%= model %>.
                charts.<%= name %>_chart_options = {
                    tooltip: {
                        trigger: 'item',
                        formatter: "{b}:<br/> {c} ({d}%)"
                    },
                    // Add legend
                    legend: {
                        x: 'center',
                        y: '56%',
                        data: <%= model %>.<%= name %>_legends
                    },
                    toolbox: {
                        show: true,
                        orient: 'horizontal',
                        x: 'left',
                        feature: {
                            restore: {
                                show: true,
                                title: 'Restore'
                            },
                            saveAsImage: {
                                show: true,
                                title: 'Same as image',
                                lang: ['Save']
                            }
                        }
                    },
                    calculable: true,
                    series:  <%= model %>.<%= name %>_data
                };
                                     <%= model %>.charts.<%= name %>_chart.setOption(<%= model %>.charts.<%= name %>_chart_options);                     setTimeout(function () {                         <%= model %>.                         charts.<%= name %>_chart.resize();                     }, 3000);                 }
                <%= model %>.charts.<%= name %>.onLoad();

            }
        );
    });

</script>